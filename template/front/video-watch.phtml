<?php
$this->css($this->assetModule('css/front.css'));
// Set Open Graph tags for meta
$this->doctype('HTML5');
$this->headMeta($this->escape($videoItem['title']), 'og:title', 'property');
$this->headMeta($this->escape($videoItem['videoUrl']), 'og:url', 'property');
$this->headMeta('video', 'og:type', 'property');
$this->headMeta($this->escape($videoItem['video_url']), 'og:video:url', 'property');
$this->headMeta($this->escape($videoItem['video_url']), 'og:video:secure_url', 'property');
$this->headMeta('video/mp4', 'og:video:type', 'property');

if (isset($videoItem['video_duration']) && !empty($videoItem['video_duration'])) {
    //$this->headMeta(_strip($videoItem['video_duration']), 'video:duration', 'property');
}
if (isset($videoItem['largeUrl']) && !empty($videoItem['largeUrl'])) {
    $this->headMeta($this->escape($videoItem['largeUrl']), 'og:image', 'property');
}
if (isset($videoItem['largeUrl']) && !empty($videoItem['largeUrl'])) {
    $this->headMeta($this->escape($videoItem['largeUrl']), 'og:image', 'property');
}
// Set twitter for meta
$this->headMeta('player', 'twitter:card');
$this->headMeta($this->escape($videoItem['title']), 'twitter:title');
if (isset($videoItem['text_summary']) && !empty($videoItem['text_summary'])) {
    $this->headMeta(_strip($videoItem['text_summary']), 'twitter:description');
}
if (isset($videoItem['largeUrl']) && !empty($videoItem['largeUrl'])) {
    $this->headMeta($this->escape($videoItem['largeUrl']), 'twitter:image');
}
$this->headMeta($this->escape($videoItem['videoUrl']), 'twitter:player');

/* if ($access) {
    if ($videoItem['server']['type'] == 'wowza') {
        $this->jQuery();
        $this->js($this->assetModule('player/shaka/shaka-player.compiled.js'));
        $script
                = <<<'EOT'
    var manifestUri = '%s';

    function initApp() {
        // Install built-in polyfills to patch browser incompatibilities.
        shaka.polyfill.installAll();

        // Check to see if the browser supports the basic APIs Shaka needs.
        if (shaka.Player.isBrowserSupported()) {
            // Everything looks good!
            initPlayer();
        } else {
            // This browser does not have the minimum set of APIs we need.
            console.error('Browser not supported!');
        }
    }

    function initPlayer() {
        // Create a Player instance.
        var video = document.getElementById('video');
        var player = new shaka.Player(video);

        // Attach player to the window to make it easy to access in the JS console.
        window.player = player;
        
        // Set config
        // player.configure({});

        // Listen for error events.
        player.addEventListener('error', onErrorEvent);

        // Try to load a manifest.
        // This is an asynchronous process.
        player.load(manifestUri).then(function() {
            // This runs if the asynchronous load is successful.
            console.log('The video has now been loaded!');
        }).catch(onError);  // onError is executed if the asynchronous load fails.
    }

    function onErrorEvent(event) {
        // Extract the shaka.util.Error object from the event.
        onError(event.detail);
    }

    function onError(error) {
        // Log the error.
        console.error('Error code', error.code, 'object', error);
    }

    document.addEventListener('DOMContentLoaded', initApp);
EOT;
        $script = sprintf($script, $videoItem['mpegDashUrl']);
        $this->footScript()->appendScript($script);
        $os = Pi::service('browser')->getPlatform();
    }
} */
?>
<div class="clearfix video-page" itemscope itemtype="https://schema.org/VideoObject">
    <div class="page-header">
        <h1 itemprop="name"><?php echo $this->escape($videoItem['title']); ?></h1>
    </div>
    <meta itemprop="thumbnail" content="<?php echo $this->escape($videoItem['largeUrl']); ?>"/>
    <meta itemprop="datePublished" content="<?php echo $this->escape(date("Y-m-d H:i:s", $videoItem['time_create'])); ?>"/>
    <meta itemprop="contentUrl" content="<?php echo $this->escape($videoItem['video_url']); ?>"/>
    <div class="row clearfix">
        <div class="col-lg-8 col-md-8 col-12">
            <div class="clearfix video-information">
                <ul class="text-muted list-inline small">
                    <li class="list-inline-item"><i class="fas fa-calendar"></i> <?php echo $this->escape($videoItem['time_update_view']); ?></li>
                    <li class="list-inline-item"><i class="fas fa-eye"></i> <?php echo _number($this->escape($videoItem['hits'])); ?></li>
                    <li class="list-inline-item"><i class="far fa-clock"></i> <?php echo $this->escape($videoItem['video_duration_view']); ?>
                    </li>
                    <li class="list-inline-item"><i class="fas fa-folder"></i></li>
                    <?php foreach ($videoItem['categories'] as $videoCategory) { ?>
                        <li class="p-category list-inline-item" itemprop="about">
                            <a title="<?php echo $this->escape($videoCategory['title']); ?>"
                               href="<?php echo $this->escape($videoCategory['url']); ?>">
                                <?php echo $this->escape($videoCategory['title']); ?>
                            </a>
                        </li>
                    <?php } ?>
                </ul>
            </div>
            <?php if ($access) { ?>
                <div class="text-center video-player">
                    <div class="clearfix">
                        <?php echo $this->video($videoItem['player']); ?>
                    </div>
                </div>
            <?php } else { ?>
                <div class="clearfix">
                    <div class="card text-center">
                        <img class="card-img-top" src="<?php echo $this->escape($videoItem['largeUrl']); ?>"
                             alt="<?php echo $this->escape($videoItem['title']); ?>">
                        <div class="card-body">
                            <p class="card-text"><?php _e('This is paid video and you dont have access to watch it, use buy button to paid and watch this video'); ?></p>
                            <div class="card-text clearfix">
                                <a target="_blank" href="<?php echo $this->escape($videoItem['payUrl']); ?>"
                                   class="btn btn-success"><?php _e('Pay and watch video'); ?></a>
                            </div>
                        </div>
                    </div>
                </div>
            <?php } ?>
            <div class="clearfix video-info-list">
                <ul class="list-inline">
                    <?php if (!empty($vote)) { ?>
                        <li class="col-lg-3 col-md-3 col-6 list-inline-item">
                            <?php include $this->template('votebar.phtml', 'front', 'vote'); ?>
                        </li>
                    <?php } ?>
                    <?php if (!empty($favourite)) { ?>
                        <li class="col-lg-3 col-md-3 col-6 list-inline-item">
                            <?php include $this->template('favouritebar.phtml', 'front', 'favourite'); ?>
                        </li>
                    <?php } ?>
                    <?php if ($config['social_sharing']) { ?>
                        <li class="col-lg-6 col-md-6 col-12 list-inline-item">
                            <div class="socialSharing">
                                <?php echo $this->socialSharing(
                                    $config['social_sharing'],
                                    $this->escape($videoItem['title']),
                                    $this->escape($videoItem['videoUrl']),
                                    $this->escape($videoItem['largeUrl'])
                                ); ?>
                            </div>
                        </li>
                    <?php } ?>
                </ul>
            </div>
            <div class="card card-body bg-light mb-3 clearfix">
                <h2><?php _e('Description'); ?></h2>
                <div class="clearfix video-info-box" itemprop="description">
                    <?php echo $videoItem['text_summary']; ?>
                </div>
                <div class="clearfix video-info-box" itemprop="description">
                    <?php echo $videoItem['text_description']; ?>
                </div>
                <?php if ($config['view_description_video'] && !empty($categorySingle['text_description'])) { ?>
                    <div class="video-info-box p-review clearfix" itemprop="description">
                        <?php echo $categorySingle['text_description']; ?>
                    </div>
                <?php } ?>
            </div>
            <?php include $this->template('front/tag'); ?>
        </div>
        <div class="col-lg-4 col-md-4 col-12">
            <?php /* <div class="video-channel" itemprop="author" itemscope itemtype="https://schema.org/Person">
                <a title="<?php _e('User channel'); ?>" href="<?php echo $this->escape($videoItem['channelUrl']); ?>">
                    <?php echo $submitter['avatar']; ?>
                    <?php echo sprintf(__('%s channel'), $this->escape($submitter['name'])); ?>
                </a>
                <meta itemprop="name" content="<?php echo $this->escape($submitter['name']); ?>" />
            </div> */ ?>
            <?php include $this->template('front/attribute'); ?>
            <?php include $this->template('front/video-related'); ?>
        </div>
    </div>
</div>